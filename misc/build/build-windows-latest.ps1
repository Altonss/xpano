# DO NOT MODIFY: Auto-generated by the gen_installer.py script from the .github/workflows/windows.yml Github Action

$env:BUILD_TYPE = 'RelWithDebInfo'
$env:SDL_VERSION = 'prerelease-2.23.1'
$env:OPENCV_VERSION = '4.6.0'
$env:CATCH_VERSION = 'v3.1.0'
$env:SPDLOG_VERSION = 'v1.10.0'
$env:GENERATOR = 'Ninja Multi-Config'


git clone https://github.com/opencv/opencv.git --depth 1 --branch $env:OPENCV_VERSION
cd opencv
cmake -B build -G "$env:GENERATOR" `
  -DBUILD_SHARED_LIBS=OFF `
  -DCMAKE_INSTALL_PREFIX="install/$env:BUILD_TYPE" `
  -DCMAKE_PROJECT_INCLUDE="C:/Users/tomas/Documents/dev/panox/asan_zi.cmake" `
  @(Get-Content ../misc/build/opencv_minimal_flags.txt)
cmake --build build --target install --config Release
cd ..


git clone https://github.com/libsdl-org/SDL.git --depth 1 --branch $env:SDL_VERSION
cd sdl
cmake -B build -G "$env:GENERATOR" `
  -DBUILD_SHARED_LIBS=OFF `
  -DCMAKE_INSTALL_PREFIX="install/$env:BUILD_TYPE" `
  -DSDL_FORCE_STATIC_VCRT=ON `
  -DCMAKE_PROJECT_INCLUDE="C:/Users/tomas/Documents/dev/panox/asan.cmake"
cmake --build build --target install --config $env:BUILD_TYPE
cd ..


git clone https://github.com/catchorg/Catch2.git catch --depth 1 --branch $env:CATCH_VERSION
cd catch
cmake -B build -G "$env:GENERATOR" `
  -DCMAKE_INSTALL_PREFIX="install/$env:BUILD_TYPE" `
  -DBUILD_TESTING=OFF `
  -DCMAKE_POLICY_DEFAULT_CMP0091=NEW `
  -DCMAKE_MSVC_RUNTIME_LIBRARY=MultiThreaded `
  -DCMAKE_PROJECT_INCLUDE="C:/Users/tomas/Documents/dev/panox/asan.cmake"
cmake --build build --target install --config $env:BUILD_TYPE
cd ..


git clone https://github.com/gabime/spdlog.git --depth 1 --branch $env:SPDLOG_VERSION
cd spdlog
cmake -B build -G "$env:GENERATOR" `
  -DCMAKE_INSTALL_PREFIX="build/install/$env:BUILD_TYPE" `
  -DCMAKE_MSVC_RUNTIME_LIBRARY=MultiThreaded `
  -DCMAKE_PROJECT_INCLUDE="C:/Users/tomas/Documents/dev/panox/asan.cmake"
cmake --build build --target install --config $env:BUILD_TYPE
cd ..

cmake -B build -G "$env:GENERATOR" `
  -DBUILD_TESTING=ON `
  -DXPANO_STATIC_VCRT=ON `
  -DCMAKE_INSTALL_PREFIX="install/$env:BUILD_TYPE" `
  -DSDL2_DIR="sdl/install/$env:BUILD_TYPE/cmake" `
  -DOpenCV_STATIC=ON `
  -DOpenCV_DIR="opencv/install/$env:BUILD_TYPE" `
  -Dspdlog_DIR="spdlog/build/install/$env:BUILD_TYPE/lib/cmake/spdlog" `
  -DCatch2_DIR="../catch/install/$env:BUILD_TYPE/lib/cmake/Catch2" `
  -DCMAKE_PROJECT_INCLUDE="C:/Users/tomas/Documents/dev/panox/asan.cmake"

cmake --build build --config $env:BUILD_TYPE --target install
cd build
ctest -C $env:BUILD_TYPE
